import{a as b,c as W,b as r,w as n,af as E,ae as o,d as C,f as A,ah as l,Q as M,e as D,F as G,aZ as _e,aj as be,L as Re,B as ye,q as ue,g as We,ay as xe,i as Oe,r as y,o as Me,a_ as de}from"./index.c44c2320.js";import{Q as he,m as ce}from"./messageCommon.5db82364.js";import{Q as Pe}from"./QPage.80b32476.js";import{f as Ve,a as N,A as B}from"./sessionFunctions.3c5066a4.js";import{B as $e}from"./BidStatus.bec4e2ae.js";import{Q as Ue,a as R}from"./QTable.50d33692.js";import{Q as me,a as je,S as Ge}from"./SeatMap.3e05a527.js";import{Q as Fe}from"./format.4f6c3584.js";import{Q as Ye}from"./QItem.35fdbb09.js";import{_ as Se}from"./plugin-vue_export-helper.21dcd24c.js";import{n as P}from"./navigate.3bf18681.js";import"./QSelect.3898a8f6.js";import"./selection.54367025.js";import"./rtl.276c3f1b.js";import"./formatTimeToLocal.04abce99.js";import"./QList.72d1a296.js";import"./urls.d05eee06.js";const ze={class:"bids-list"},Ke={__name:"BidsList",props:{seats:Array,tableColumns:Array,selectedHistoryButton:Number,totalWinAmount:Number,totalWinCount:Number,totalBidAmount:Number,isApproved:Boolean},emits:["toggleHistory","paySubmit","selectVenue"],setup(d,{emit:f}){const h=d,m=f,S=v=>new Date(v).toLocaleString(),T=v=>{m("toggleHistory",v)},p=v=>h.selectedHistoryButton===v.seat_no,q=()=>{m("paySubmit")},k=()=>{m("selectVenue")};return(v,i)=>(b(),W("div",ze,[r(be,{class:"q-pa-md q-mb-md"},{default:n(()=>[r(E,null,{default:n(()=>i[0]||(i[0]=[o("h6",null,"\uC785\uCC30 \uBC0F \uB099\uCC30 \uD604\uD669",-1)])),_:1}),d.seats.length===0?(b(),C(E,{key:0},{default:n(()=>[r(he,{color:"warning"},{default:n(()=>i[1]||(i[1]=[A("\uC785\uCC30 \uB0B4\uC5ED\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.")])),_:1})]),_:1})):(b(),C(E,{key:1},{default:n(()=>[r(Ue,{rows:d.seats,columns:d.tableColumns,"row-key":"seat_no",flat:""},{body:n(t=>[r(me,{props:t},{default:n(()=>[r(R,{class:"important-text"},{default:n(()=>[A(l(t.row.bidWonStatus),1)]),_:2},1024),r(R,null,{default:n(()=>[A(l(t.row.seat_no)+" ("+l(t.row.row_no)+" \uC5F4 "+l(t.row.col_no)+"\uBC88) "+l(t.row.paidStatus),1)]),_:2},1024),r(R,null,{default:n(()=>[A(l(t.row.bid_amount.toLocaleString())+"\uC6D0 : "+l(S(t.row.bid_at)),1)]),_:2},1024),r(R,null,{default:n(()=>[A(l((t.row.highest_bid_amount||0).toLocaleString())+"\uC6D0 ",1)]),_:2},1024),r(R,null,{default:n(()=>[t.row.historyButtonEnabled?(b(),C(M,{key:0,onClick:s=>T(t.row),color:p(t.row)?"primary":"secondary",size:"xs",icon:p(t.row)?"keyboard_arrow_up":"keyboard_arrow_down"},{default:n(()=>[r(je,{color:p(t.row)?"primary":"secondary"},{default:n(()=>[A(" \uC774\uB825 "+l(t.row.bidHistory.length)+"\uAC74 ",1)]),_:2},1032,["color"])]),_:2},1032,["onClick","color","icon"])):D("",!0)]),_:2},1024)]),_:2},1032,["props"]),t.row.historyShow?(b(),C(me,{key:0},{default:n(()=>[r(R,{colspan:"4"},{default:n(()=>[(b(!0),W(G,null,_e(t.row.bidHistory,(s,g)=>(b(),C(Ye,{key:g},{default:n(()=>[r(Fe,null,{default:n(()=>[A(l(s.bid_amount.toLocaleString())+"\uC6D0 : "+l(S(s.bid_at)),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)):D("",!0)]),_:1},8,["rows","columns"]),o("div",null," \uB099\uCC30\uAE08\uC561 \uD569\uACC4: "+l(d.totalWinAmount.toLocaleString())+"\uC6D0 \xA0\xA0 "+l(d.totalWinCount)+"\uAC74 \xA0\xA0\xA0\xA0\xA0 \uC785\uCC30\uAE08\uC561 \uD569\uACC4: "+l(d.totalBidAmount.toLocaleString())+"\uC6D0 ",1)]),_:1})),r(E,null,{default:n(()=>[r(M,{push:"",color:"white","text-color":"blue-grey-14",onClick:q,disable:d.isApproved||d.totalWinAmount===0,label:"\uB099\uCC30 \uB0B4\uC6A9 \uACB0\uC81C"},null,8,["disable"]),i[2]||(i[2]=A("\xA0\xA0\xA0\xA0\xA0 ")),r(M,{push:"",color:"white","text-color":"deep-orange-14",onClick:k,label:"\uACBD\uAE30 \uB2E4\uC2DC \uC120\uD0DD"})]),_:1})]),_:1})]))}};const Xe={class:"common-container"},Ze=["onUpdate:modelValue","onInput","disabled"],Je={key:0},et={__name:"SelectedSeatsDetails",props:{selectedSeats:{type:Array,required:!0},bidAmounts:{type:Object,required:!0},isClosedBid:{type:Boolean,required:!0}},emits:["bidAmountChange","submit-bid","cancel-bid"],setup(d,{emit:f}){const h=d,m=f,S=Re({...h.bidAmounts});ye(()=>h.bidAmounts,i=>{Object.keys(i).forEach(t=>{S[t]=i[t]})},{deep:!0});const T=(i,t)=>{const s=parseFloat(i.target.value)||0;S[t.uniqueSeatId]=s,m("bidAmountChange",s,t)},p=ue(()=>h.selectedSeats.reduce((i,t)=>{const s=t.current_bid_amount>0?t.current_bid_amount:t.seat_price;return i+(s||0)},0)),q=ue(()=>Object.values(S).reduce((i,t)=>i+t,0)),k=()=>{m("submit-bid",q.value)},v=()=>{Object.keys(S).forEach(i=>{S[i]=0}),m("cancel-bid")};return(i,t)=>(b(),W(G,null,[o("div",Xe,[t[2]||(t[2]=o("div",{style:{"text-align":"center"}},"\uC120\uD0DD \uC88C\uC11D \uC0C1\uC138 \uC815\uBCF4",-1)),o("table",null,[t[1]||(t[1]=o("thead",null,[o("tr",null,[o("th",null,"\uC88C\uC11D \uBC88\uD638"),o("th",null,"\uC88C\uC11D \uAC00\uACA9"),o("th",null,"\uCD1D \uC785\uCC30\uC790 \uC218"),o("th",null,"\uCD5C\uACE0 \uC785\uCC30 \uAE08\uC561"),o("th",null,"\uC785\uCC30 \uAE08\uC561"),o("th",null,"\uBE44\uACE0")])],-1)),o("tbody",null,[(b(!0),W(G,null,_e(d.selectedSeats,s=>(b(),W("tr",{key:s.uniqueSeatId},[o("td",null,l(s.seat_no)+"\uBC88 : "+l(s.row_no)+"\uC5F4 "+l(s.col_no),1),o("td",null,l(s.seat_price)+"\uC6D0",1),o("td",null,l(s.total_bidders)+"\uBA85",1),o("td",null,l(s.current_bid_amount)+"\uC6D0",1),o("td",null,[We(o("input",{type:"number","onUpdate:modelValue":g=>s.bid_Amount=g,onInput:g=>T(g,s),disabled:d.isClosedBid},null,40,Ze),[[xe,s.bid_Amount,void 0,{number:!0}]])]),o("td",null,l(s.submitResult),1)]))),128)),d.selectedSeats.length===0?(b(),W("tr",Je,t[0]||(t[0]=[o("td",{colspan:"6",style:{"text-align":"center"}},"\uC120\uD0DD \uC815\uBCF4\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.",-1)]))):D("",!0)])]),o("div",null,[o("span",null,"\uCD5C\uC800 \uC785\uCC30 \uAE08\uC561 \uD569\uACC4: "+l(p.value)+"\uC6D0",1),o("span",null,"\uD604\uC7AC \uC785\uCC30 \uAE08\uC561: "+l(q.value)+"\uC6D0",1)])]),o("div",null,[d.selectedSeats.length>0&&!d.isClosedBid?(b(),C(M,{key:0,onClick:k,color:"primary",label:"\uC785\uCC30 \uC81C\uCD9C"})):D("",!0),d.selectedSeats.length>0&&!d.isClosedBid?(b(),C(M,{key:1,onClick:v,color:"warning",label:"\uC791\uC5C5 \uCDE8\uC18C"})):D("",!0)])],64))}};var tt=Se(et,[["__scopeId","data-v-ff6871aa"]]);const j=5,at="O",ot={__name:"BidSeats",setup(d){const f=Ve(["userContext","userName","matchNumber"]);let h={},m=0,S="";const T=Oe(),p=y(!1),q=y(!1),k=y(-1),v=y([]),i=y([]),t=y([]),s=y(0),g=y({}),F=y(0),V=y(0),$=y(0),x=y({}),U=y({}),H=y(""),ve=y([{name:"bidWonStatus",required:!0,label:"\uB099\uCC30\uC0C1\uD0DC",align:"left",field:e=>e.bidWonStatus},{name:"seat_no",required:!0,label:"\uC88C\uC11D\uBC88\uD638",align:"left",field:e=>e.seat_no},{name:"bid_amount",label:"\uC785\uCC30 \uAE08\uC561",align:"left"},{name:"highest_bid_amount",label:"\uD604\uC7AC \uCD5C\uACE0\uAC00",align:"left"},{name:"bidHistory",label:"\uC774\uB825",align:"left"}]),fe=async e=>{try{const a=await N.get(B.GET_BIDSTATUS,{params:{matchNumber:e},withCredentials:!0});x.value=a.data,a.data.bidStatusCode!==at&&(p.value=!0)}catch(a){I(a)}},Y=async()=>{try{const e=await N.get(B.GET_MY_LASTBIDS,{params:{telno:h.telno,matchNumber:m},withCredentials:!0});v.value=e.data.map(a=>(x.value.bid_open_status==="F"&&a.bid_won==="Y"&&(V.value+=a.bid_amount||0,$.value++),{...a,bidWonStatus:x.value.bid_open_status==="F"?a.bid_won==="Y"?"\uB099\uCC30":"\uC720\uCC30":" ",paidStatus:x.value.bid_open_status==="F"?a.bid_paid==="Y"?"\uACB0\uC81C\uC644\uB8CC":"\uBBF8\uACB0\uC81C":" ",historyButtonEnabled:!1,historyShow:!1})),F.value=v.value.reduce((a,c)=>a+(c.bid_amount||0),0)}catch(e){I(e)}},z=async()=>{try{(await N.get(B.GET_MY_BIDS,{params:{telno:h.telno,matchNumber:m},withCredentials:!0})).data.forEach(a=>{const c=v.value.find(u=>String(u.seat_no)===String(a.seat_no)),_=a.bidHistory||[{bid_amount:a.bid_amount,bid_at:a.bid_at}];c?(c.bidHistory=c.bidHistory||[],c.bidHistory=[...c.bidHistory,..._],c.historyButtonEnabled=c.bidHistory.length>1,c.historyShow=!1):console.log("\uC624\uB958: \uC88C\uC11D\uBC88\uD638\uAC00 match\uB418\uC9C0 \uC54A\uB294 \uC774\uB825\uC774 \uC788\uC2B5\uB2C8\uB2E4.:",a)})}catch(e){console.error("\uC5D0\uB7EC \uBC1C\uC0DD:",e),I(e)}},K=async()=>{try{const e=await N.get(B.GET_BID_TALLIES,{params:{matchNumber:m},withCredentials:!0});i.value=e.data.map(a=>({...a,seat_no:a.seat_no,highest_bid_amount:a.current_bid_amount||0,bid_count:a.total_bidders||0}))}catch(e){I(e)}},ge=e=>{t.value=t.value.some(a=>a.uniqueSeatId===e)?t.value.filter(a=>a.uniqueSeatId!==e):[...t.value,{seat_no:e,uniqueSeatId:e}],t.value.length>j&&(alert(`\uCD5C\uB300 ${j}\uAC1C\uC758 \uC88C\uC11D\uB9CC \uC120\uD0DD\uD560 \uC218 \uC788\uC2B5\uB2C8\uB2E4.`),t.value=t.value.slice(0,j)),s.value+=1},pe=async(e,a,c,_)=>{try{const u=a&&Array.isArray(a)?a.map(L=>L.seat_no):[];if(u.length>0){const Q=(await N.post(B.GET_BIDS_BY_SEATARRAY,{seatNoArray:u,matchNumber:e},{withCredentials:!0})).data.reduce((w,O)=>(w[O.seat_no]=O,w),{}),J=a.map(w=>{var O,ee,te,ae,oe,ne,le,se,re,ie;return{...w,...Q[w.seat_no],row_no:(ee=(O=Q[w.seat_no])==null?void 0:O.row_no)!=null?ee:"0",col_no:(ae=(te=Q[w.seat_no])==null?void 0:te.col_no)!=null?ae:"0",seat_price:(ne=(oe=Q[w.seat_no])==null?void 0:oe.seat_price)!=null?ne:0,total_bidders:(se=(le=Q[w.seat_no])==null?void 0:le.total_bidders)!=null?se:0,current_bid_amount:(ie=(re=Q[w.seat_no])==null?void 0:re.current_bid_amount)!=null?ie:0}});console.log(J),c(J)}}catch(u){_&&_("\uB370\uC774\uD130\uB97C \uAC00\uC838\uC624\uB294 \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4."),I(u)}},we=async e=>{const a=u=>u.current_bid_amount>0?u.current_bid_amount:u.seat_price,c=t.value.filter(u=>{const L=a(u)||0;return(g.value[u.uniqueSeatId]||0)<=L});if(c.length>0){const u=c.map(L=>L.seat_no).join(", ");alert(`\uC88C\uC11D ${u}\uC758 \uC785\uCC30 \uAE08\uC561\uC774 \uD604\uC7AC \uC785\uCC30 \uCD5C\uC800\uAC00\uBCF4\uB2E4 \uC791\uC2B5\uB2C8\uB2E4.`);return}const _=`\uC785\uCC30 \uAE08\uC561 ${e}\uC6D0\uC73C\uB85C \uC81C\uCD9C\uB429\uB2C8\uB2E4. \uC9C4\uD589\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?`;de.create({title:"\uC785\uCC30 \uB0B4\uC6A9 \uC81C\uCD9C",message:_,cancel:!0,persistent:!0,ok:{label:"\uC608",color:"primary"},cancel:{label:"\uC544\uB2C8\uC624",color:"negative"}}).onOk(()=>{Be()}).onCancel(()=>{alert("\uC81C\uCD9C\uC774 \uCDE8\uC18C\uB418\uC5C8\uC2B5\uB2C8\uB2E4.")})},Be=async()=>{try{const e=await N.post(B.SUBMIT_BID,{telno:h.telno,matchNumber:m,bidArray:t.value.map(_=>({matchNumber:_.match_no,seatNo:_.seat_no,bidAmount:g.value[_.uniqueSeatId]||0}))},{withCredentials:!0}),c=e.data.reduce((_,u)=>(_[u.seat_no]=u,_),{});t.value=t.value.map(_=>{const u=c[_.seat_no];return{..._,submitResult:(u==null?void 0:u.message)||"x"}}),e.status===200&&(alert("\uC131\uACF5\uC801\uC73C\uB85C \uC785\uCC30\uC774 \uB4F1\uB85D\uB418\uC5C8\uC2B5\uB2C8\uB2E4."),H.value=e.data.message,Y(),z(),K())}catch(e){I(e)}},Ce=()=>{de.create({title:"\uC785\uCC30 \uC81C\uCD9C \uCDE8\uC18C",message:"\uBAA8\uB4E0 \uC785\uB825 \uB0B4\uC6A9\uC774 \uCDE8\uC18C\uB429\uB2C8\uB2E4. \uC9C4\uD589\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?",cancel:!0,persistent:!0,ok:{label:"\uC608",color:"primary"},cancel:{label:"\uC544\uB2C8\uC624",color:"negative"}}).onOk(()=>{t.value=[]}).onCancel(()=>{})},Ae=e=>{k.value===e.seat_no?(e.historyShow=!1,k.value=-1):(k.value=e.seat_no,e.historyShow=!0)},Te=(e,a)=>{g.value={...g.value,[a.uniqueSeatId]:parseFloat(e)||0}},ke=e=>Object.keys(e).map(a=>`${encodeURIComponent(a)}=${encodeURIComponent(e[a])}`).join("&"),Ne=()=>{localStorage.setItem("telno",h.telno),U.value={...U.value,telno:h.telno,price:V.value,goodName:`\uC88C\uC11D\uC785\uCC30 \uCD1D ${$.value} \uAC74`};const e=ke(U.value),a=`${Ie()?B.PG_START_MOBILE:B.PG_START}?${e}`;window.location.href=a};function Ie(){return/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)}const Ee=()=>{P(T,f.userContext,"selectVenue")},De=()=>{P(T,f.userContext,"login")},X=()=>{P(T,f.userContext,"bids")},qe=()=>{alert("\uACBD\uAE30\uB97C \uC120\uD0DD\uD574\uC8FC\uC138\uC694."),P(T,f.userContext,"selectVenue")},He=async()=>{try{const e=await N.post(B.RESTORE_SESSION,{telno:h.telno,userName:f.userName},{withCredentials:!0})}catch(e){console.error("\uC138\uC158 \uBCF5\uAD6C\uAC00 \uC2E4\uD328\uD558\uC600\uC2B5\uB2C8\uB2E4.:",e)}};ye([s],()=>{t.value.length>0&&pe(m,t.value,e=>{t.value=e},e=>{H.value=e})},{deep:!0});const Z=async()=>{try{await fe(m),await Y(),await z(),await K()}catch(e){I(e)}},Le=async()=>{try{h=(await N.get(B.GET_SESSION_USER,{withCredentials:!0})).data,sessionStorage.setItem("userName",h.userName),S?(await Z(),X()):await Z()}catch(e){H.value=e.response?e.response.data:e.response,S?(await He(S,f.userName),X()):De()}},I=e=>{H.value=e.response?e.response.data:e.request?ce.ERR_NETWORK:ce.ERR_ETC};return Me(async()=>{m=f.matchNumber,m||(alert("\uACBD\uAE30\uB97C \uBA3C\uC800 \uC120\uD0DD\uD574\uC8FC\uC138\uC694."),qe());const e=window.location.search,a=new URLSearchParams(e);a.has("telno")&&(S=a.get("telno"),console.log("returned from payment----------- telno :"+S.value)),await Le()}),(e,a)=>(b(),C(Pe,{class:"common-container"},{default:n(()=>[r($e,{bidStatus:x.value},null,8,["bidStatus"]),r(Ke,{seats:v.value,tableColumns:ve.value,selectedHistoryButton:k.value,totalWinAmount:V.value,totalWinCount:$.value,totalBidAmount:F.value,isApproved:q.value,onToggleHistory:Ae,onPaySubmit:Ne,onSelectVenue:Ee},null,8,["seats","tableColumns","selectedHistoryButton","totalWinAmount","totalWinCount","totalBidAmount","isApproved"]),p.value?D("",!0):(b(),C(be,{key:0,class:"q-pa-md"},{default:n(()=>[r(E,null,{default:n(()=>[r(Ge,{selectedSeats:t.value,bidsArray:i.value,disabled:p.value,onSeatClick:ge},null,8,["selectedSeats","bidsArray","disabled"])]),_:1}),r(E,null,{default:n(()=>[r(tt,{selectedSeats:t.value,bidAmounts:g.value,onBidAmountChange:Te,isClosedBid:p.value,onSubmitBid:we,onCancelBid:Ce},null,8,["selectedSeats","bidAmounts","isClosedBid"])]),_:1}),H.value?(b(),C(E,{key:0},{default:n(()=>[r(he,{color:"deep-orange-14"},{default:n(()=>[A(l(H.value),1)]),_:1})]),_:1})):D("",!0)]),_:1}))]),_:1}))}};var pt=Se(ot,[["__scopeId","data-v-412d0700"]]);export{pt as default};
