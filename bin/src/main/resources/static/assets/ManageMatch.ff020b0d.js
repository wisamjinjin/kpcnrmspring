import{m as Y,Q as S}from"./messageCommon.5db82364.js";import{i as ve,r as b,q as U,o as ce,a as v,d as w,w as m,aj as $,ae as s,b as n,f as C,c as E,Q as T,e as y,ah as A,ag as p,az as be}from"./index.c44c2320.js";import{a as pe,Q as fe}from"./QTable.50d33692.js";import{Q as j}from"./QSelect.3898a8f6.js";import{Q as _e}from"./QForm.dd25b1b3.js";import{Q as we}from"./QPage.80b32476.js";import{f as Ce,b as Te,a as h,A as f}from"./sessionFunctions.3c5066a4.js";import{f as z}from"./formatTimeToLocal.04abce99.js";import"./urls.d05eee06.js";import"./QList.72d1a296.js";import"./QItem.35fdbb09.js";import"./format.4f6c3584.js";import"./selection.54367025.js";import"./rtl.276c3f1b.js";const ye={key:1},ge={key:0},Ve={class:"row q-mt-md q-col-gutter-md"},Ne={key:2,class:"q-mt-md"},De={class:"row q-col-gutter-md"},Ae={class:"rowflex-container"},he={class:"rowflex-container"},ke={hidden:""},Me={hidden:""},Se={class:"row q-col-gutter-md"},Ue={class:"row q-col-gutter-md"},Oe={class:"row q-col-gutter-md"},Le={class:"row q-col-gutter-md"},qe={class:"row q-col-gutter-md"},Ee=["disabled"],Be={class:"row q-col-gutter-md"},Qe="Y",el={__name:"ManageMatch",setup(xe){ve();const O=Ce(["userContext","venueCd"]);let g={},B="",L="",V=!1;const k=b([]),Q=b([]),a=b({matchNumber:"",venueCd:"",venueName:"",matchName:"",round:"",startDate:"",startTime:"",endTime:"",bidOpenTime:"",bidCloseTime:"",isBidAvailable:"",file:null,fileName:""}),d=b(!1),u=b(!1),o=b(!1),r=b(""),_=b(""),G=U(()=>k.value.map(e=>({...e,bid_open_time:z(e.bid_open_datetime),bid_close_time:z(e.bid_close_datetime),approveStatus:e.approved==="Y"?"\uC2B9\uC778":"\uBBF8\uC2B9\uC778",bidLable:e.is_bid_available==="Y"?"\uC785\uCC30\uAC00\uB2A5":"\uC785\uCC30\uBD88\uAC00\uB2A5"}))),W=U(()=>Q.value.map(e=>({label:e.venue_name,value:e.venue_cd}))),K=U(()=>[{label:"\uC785\uCC30 \uAC00\uB2A5",value:"Y"},{label:"\uC785\uCC30 \uBD88\uAC00\uB2A5",value:"N"}]),x=U(()=>d.value?"\uC815\uBCF4 \uC785\uB825 \uD6C4 \uD655\uC778\uBC84\uD2BC\uC744 \uD074\uB9AD\uD558\uC138\uC694.":u.value?"\uACBD\uAE30 \uC815\uBCF4\uB97C \uC218\uC815\uD55C \uD6C4 \uD655\uC778\uBC84\uD2BC\uC744 \uD074\uB9AD\uD558\uC138\uC694.":o.value?"\uC0AD\uC81C\uD560 \uC815\uBCF4\uAC00 \uB9DE\uC73C\uBA74 \uD655\uC778\uBC84\uD2BC\uC744 \uD074\uB9AD\uD558\uC138\uC694.":""),Z=[{name:"match_no",label:"\uACBD\uAE30\uBC88\uD638",field:"match_no"},{name:"venue_name",label:"\uACBD\uAE30\uC7A5",field:"venue_name"},{name:"match_name",label:"\uACBD\uAE30\uBA85",field:"match_name"},{name:"round",label:"\uB77C\uC6B4\uB4DC",field:"round"},{name:"start_date",label:"\uACBD\uAE30 \uC77C\uC790",field:"start_date"},{name:"start_time",label:"\uC2DC\uC791 \uC2DC\uAC04",field:"start_time"},{name:"end_time",label:"\uC885\uB8CC \uC2DC\uAC04",field:"end_time"},{name:"bidLable",label:"\uC785\uCC30 \uD5C8\uC6A9 \uC5EC\uBD80",field:"bidLable"},{name:"bid_open_time",label:"\uC785\uCC30 \uAC1C\uC2DC",field:"bid_open_time"},{name:"bid_close_time",label:"\uC785\uCC30 \uC885\uB8CC",field:"bid_close_time"},{name:"approveStatus",label:"\uC0C1\uD0DC",field:"approveStatus"},{name:"actions",label:"\uBCC0\uACBD",align:"center"}],J=()=>Math.floor(Math.random()*1e10).toString().padStart(10,"0"),X=e=>{B=e.value},ee=e=>{L=e.value},le=e=>{const l=e.target.files?e.target.files[0]:null;if(!/^[a-zA-Z0-9]+$/.test(l.name.split(".")[0])){alert("\uD30C\uC77C \uC774\uB984\uC740 \uC601\uBB38\uC790\uC640 \uC22B\uC790\uB9CC \uD5C8\uC6A9\uB429\uB2C8\uB2E4."),V=!1;return}l&&(V=!0,a.value.file=l,a.value.fileName=l.name)},R=async()=>{try{const e=await h.get(f.GET_ALLMATCHES,{params:{telno:g.telno,userType:g.userType,venueCd:O.venueCd}});e.status===200&&(k.value=e.data)}catch(e){N(e)}},ae=async()=>{try{const e=await h.get(f.GET_ALL_VENUES);e.status===200&&(Q.value=e.data)}catch(e){N(e)}},I=async()=>{if(!o.value&&!ue())return;B||a.value.venueCd;let e;if(L?e=L:e=a.value.isBidAvailable,V){const c=J();a.value.fileName=c+"_"+a.value.fileName}else _.value="\uC5C5\uB85C\uB4DC \uD560 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.";const l={...a.value,telno:g.telno,userType:g.userType,venueCd:O.venueCd,isBidAvailable:e},t={insert:f.ADD_MATCH,update:f.UPDATE_MATCH,delete:f.DELETE_MATCH},i=d.value?"insert":u.value?"update":o.value?"delete":null;if(!i){console.warn("\uC720\uD6A8\uD55C \uC791\uC5C5 \uBAA8\uB4DC\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");return}const M=t[i];try{const c=await h.post(M,l);c.status===200&&(r.value=c.data.message,(u.value||d.value)&&V&&(alert("\uCCA8\uBD80\uD654\uC77C\uC774 \uC5C5\uB85C\uB4DC\uB418\uC5C8\uC2B5\uB2C8\uB2E4."),se()),R(),D())}catch(c){N(c)}},te=()=>{D(),r.value="\uC791\uC5C5\uC774 \uCDE8\uC18C\uB418\uC5C8\uC2B5\uB2C8\uB2E4."},se=async()=>{const e=new FormData;e.append("file",a.value.file,a.value.fileName);try{(await h.post(f.UPLOAD_MATCHINFO,e,{headers:{"Content-Type":"multipart/form-data"}})).status===200&&(_.value="\uD30C\uC77C \uC5C5\uB85C\uB4DC\uAC00 \uC131\uACF5\uC801\uC73C\uB85C \uC218\uD589\uB418\uC5C8\uC2B5\uB2C8\uB2E4.")}catch(l){N(l)}},oe=async e=>{if(!e){r.value("\uCCA8\uBD80\uD654\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.");return}try{const l=await h.get(f.DOWNLOAD_MATCHINFO,{params:{fileName:e},responseType:"blob"}),t=window.URL.createObjectURL(new Blob([l.data])),i=document.createElement("a");i.href=t,i.setAttribute("download",e),document.body.appendChild(i),i.click(),i.remove(),window.URL.revokeObjectURL(t)}catch(l){N(l)}},ne=()=>{H(),D(),q(),H(),d.value=!0},ie=e=>{F(e),D(),q(),u.value=!0},de=e=>{F(e),D(),q(),o.value=!0},N=e=>{e.response?r.value=e.response.data:e.request?r.value=Y.ERR_NETWORK:r.value=Y.ERR_ETC},F=e=>{a.value={matchNumber:e.match_no,venueCd:e.venue_cd,venueName:e.venue_name,matchName:e.match_name,round:e.round,startDate:e.start_date?new Date(e.start_date).toISOString().slice(0,10):"",startTime:e.start_time?e.start_time.slice(0,5):"",endTime:e.end_time?e.end_time.slice(0,5):"",bidOpenTime:e.bid_open_datetime?new Date(e.bid_open_datetime).toISOString().slice(0,16):"",bidCloseTime:e.bid_close_datetime?new Date(e.bid_close_datetime).toISOString().slice(0,16):"",isBidAvailable:e.is_bid_available,bidLable:e.is_bid_available==="Y"?"\uC785\uCC30\uAC00\uB2A5":"\uC785\uCC30\uBD88\uAC00\uB2A5",fileName:e.filename_attached}},ue=()=>{const{matchName:e,round:l,startDate:t,startTime:i,endTime:M,bidOpenTime:c,bidCloseTime:re,isBidAvailable:Re}=a.value,me=new Date(c),P=new Date(re);return e?l?t?i?M?P<=me?(alert("\uC785\uCC30 \uB9C8\uAC10\uC2DC\uAC04\uC740 \uC785\uCC30 \uC2DC\uC791\uC2DC\uAC04\uBCF4\uB2E4 \uCEE4\uC57C \uD569\uB2C8\uB2E4."),!1):P>=new Date(t)?(alert("\uC785\uCC30 \uC885\uB8CC \uC2DC\uAC04\uC740 \uACBD\uAE30 \uC2DC\uC791 \uC2DC\uAC04\uBCF4\uB2E4 \uC791\uC544\uC57C \uD569\uB2C8\uB2E4."),!1):new Date(M)<=new Date(i)?(alert("\uACBD\uAE30 \uC885\uB8CC \uC2DC\uAC04\uC740 \uC2DC\uC791 \uC2DC\uAC04\uBCF4\uB2E4 \uCEE4\uC57C \uD569\uB2C8\uB2E4."),!1):!0:(alert("\uC885\uB8CC \uC2DC\uAC04\uC744 \uC785\uB825\uD574 \uC8FC\uC138\uC694."),!1):(alert("\uC2DC\uC791 \uC2DC\uAC04\uC744 \uC785\uB825\uD574 \uC8FC\uC138\uC694."),!1):(alert("\uACBD\uAE30 \uC77C\uC790\uB97C \uC785\uB825\uD574 \uC8FC\uC138\uC694."),!1):(alert("\uB77C\uC6B4\uB4DC\uB97C \uC785\uB825\uD574 \uC8FC\uC138\uC694."),!1):(alert("\uACBD\uAE30\uBA85\uC744 \uC785\uB825\uD574 \uC8FC\uC138\uC694."),!1)},D=()=>{d.value=!1,u.value=!1,o.value=!1,V=!1},H=()=>{a.value={matchNumber:"",venueCd:"",venueName:"",matchName:"",round:"",startDate:"",startTime:"",endTime:"",bidOpenTime:"",bidCloseTime:"",isBidAvailable:"",fileName:""},r.value="",_.value=""},q=()=>{r.value="",_.value=""};return ce(async()=>{g=await Te(O.userContext),await ae(),await R()}),(e,l)=>(v(),w(we,{class:"common-container"},{default:m(()=>[!k.value||k.value.length===0?(v(),w($,{key:0},{default:m(()=>[l[11]||(l[11]=s("br",null,null,-1)),l[12]||(l[12]=s("br",null,null,-1)),l[13]||(l[13]=s("br",null,null,-1)),n(S,null,{default:m(()=>l[10]||(l[10]=[C("\uD604\uC7AC \uB300\uD68C \uC815\uBCF4\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.")])),_:1}),l[14]||(l[14]=s("br",null,null,-1)),l[15]||(l[15]=s("br",null,null,-1)),l[16]||(l[16]=s("br",null,null,-1))]),_:1})):(v(),E("div",ye,[l[17]||(l[17]=s("h5",{class:"text-center"},"\uACBD\uAE30 \uC815\uBCF4",-1)),n(fe,{rows:G.value,columns:Z,"row-key":"match_no",flat:"",dense:"","rows-per-page":20},{"body-cell-actions":m(t=>[n(pe,null,{default:m(()=>[n(T,{label:"\uCCA8\uBD80 \uB2E4\uC6B4\uB85C\uB4DC",color:"secondary",disable:!t.row.filename_attached,icon:"download",onClick:i=>oe(t.row.filename_attached),flat:""},null,8,["disable","onClick"]),t.row.approved!==Qe?(v(),E("div",ge,[n(T,{onClick:i=>ie(t.row),push:"",color:"white","text-color":"blue-grey-14",label:"\uC218\uC815",disable:u.value||o.value||d.value},null,8,["onClick","disable"]),n(T,{onClick:i=>de(t.row),push:"",color:"white","text-color":"deep-orange-14",label:"\uC0AD\uC81C",disable:u.value||o.value||d.value},null,8,["onClick","disable"])])):y("",!0)]),_:2},1024)]),_:1},8,["rows"])])),s("div",Ve,[u.value||o.value||d.value?y("",!0):(v(),w(T,{key:0,onClick:ne,label:"\uACBD\uAE30 \uCD94\uAC00",class:"q-mt-md",color:"primary"}))]),n($,null,{default:m(()=>[x.value?(v(),w(S,{key:0,type:"info",class:"q-mt-md"},{default:m(()=>[C(A(x.value),1)]),_:1})):y("",!0)]),_:1}),d.value||u.value||o.value?(v(),E("div",Ne,[n(_e,{onSubmit:be(I,["prevent"])},{default:m(()=>[s("div",De,[n(p,{modelValue:a.value.matchNumber,"onUpdate:modelValue":l[0]||(l[0]=t=>a.value.matchNumber=t),label:"\uACBD\uAE30 \uBC88\uD638",readonly:"",class:"col-12 col-md-6"},null,8,["modelValue"]),s("div",null,[s("div",Ae,[l[18]||(l[18]=C(" \uACBD\uAE30\uC7A5\xA0\xA0\xA0\xA0\xA0\xA0 ")),n(j,{modelValue:a.value.venueName,"onUpdate:modelValue":[l[1]||(l[1]=t=>a.value.venueName=t),X],options:W.value,disable:o.value,class:"col-12 col-md-6"},null,8,["modelValue","options","disable"])]),s("div",he,[l[19]||(l[19]=C(" \uC785\uCC30\uC5EC\uBD80\xA0\xA0\xA0\xA0\xA0\xA0 ")),n(j,{modelValue:a.value.bidLable,"onUpdate:modelValue":[l[2]||(l[2]=t=>a.value.bidLable=t),ee],options:K.value,class:"col-12 col-md-6",disable:o.value},null,8,["modelValue","options","disable"])]),s("div",ke,A(a.value.venueCd),1),s("div",Me,A(a.value.isBidAvailable),1)])]),s("div",Se,[n(p,{modelValue:a.value.matchName,"onUpdate:modelValue":l[3]||(l[3]=t=>a.value.matchName=t),label:"\uACBD\uAE30\uBA85",disable:o.value,class:"col-12 col-md-6"},null,8,["modelValue","disable"])]),s("div",Ue,[n(p,{modelValue:a.value.round,"onUpdate:modelValue":l[4]||(l[4]=t=>a.value.round=t),label:"\uB77C\uC6B4\uB4DC",disable:o.value,class:"col-12 col-md-6"},null,8,["modelValue","disable"]),n(p,{modelValue:a.value.startDate,"onUpdate:modelValue":l[5]||(l[5]=t=>a.value.startDate=t),label:"\uACBD\uAE30 \uC77C\uC790",type:"date",disable:o.value,class:"col-12 col-md-6"},null,8,["modelValue","disable"])]),s("div",Oe,[n(p,{modelValue:a.value.startTime,"onUpdate:modelValue":l[6]||(l[6]=t=>a.value.startTime=t),label:"\uC2DC\uC791 \uC2DC\uAC04",type:"time",disable:o.value,class:"col-12 col-md-6"},null,8,["modelValue","disable"]),n(p,{modelValue:a.value.endTime,"onUpdate:modelValue":l[7]||(l[7]=t=>a.value.endTime=t),label:"\uC885\uB8CC \uC2DC\uAC04",type:"time",disable:o.value,class:"col-12 col-md-6"},null,8,["modelValue","disable"])]),s("div",Le,[n(p,{modelValue:a.value.bidOpenTime,"onUpdate:modelValue":l[8]||(l[8]=t=>a.value.bidOpenTime=t),label:"\uC785\uCC30 \uAC1C\uC2DC",type:"datetime-local",disable:o.value,class:"col-12 col-md-6"},null,8,["modelValue","disable"]),n(p,{modelValue:a.value.bidCloseTime,"onUpdate:modelValue":l[9]||(l[9]=t=>a.value.bidCloseTime=t),label:"\uC785\uCC30 \uC885\uB8CC",type:"datetime-local",disable:o.value,class:"col-12 col-md-6"},null,8,["modelValue","disable"])]),s("div",qe,[s("input",{type:"file",onChange:le,disabled:o.value,class:"col-12 col-md-6"},null,40,Ee)]),l[20]||(l[20]=s("br",null,null,-1))]),_:1}),s("div",Be,[n(T,{push:"",color:"whilte","text-color":"blue-grey-14",class:"q-mt-md col-xs-12 col-sm-6",onClick:I,type:"submit",label:"\uD655\uC778",disable:!d.value&&!u.value&&!o.value},null,8,["disable"]),n(T,{push:"",color:"white","text-color":"deep-orange-14",class:"q-mt-md col-xs-12 col-sm-6",onClick:te,label:"\uCDE8\uC18C"})])])):y("",!0),r.value?(v(),w(S,{key:3,type:"info"},{default:m(()=>[C(A(r.value),1)]),_:1})):y("",!0),_.value?(v(),w(S,{key:4,type:"info"},{default:m(()=>[C(A(_.value),1)]),_:1})):y("",!0)]),_:1}))}};export{el as default};
