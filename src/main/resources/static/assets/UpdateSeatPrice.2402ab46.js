import{i as oe,r as c,o as se,k as ne,a as h,d as $,w as r,b as o,ae as m,c as x,Q as p,f as g,e as D,ah as re,aj as ue,af as ie,ag as _,ai as de,aY as ce}from"./index.c44c2320.js";import{m as L,Q as O}from"./messageCommon.5db82364.js";import{a as w,Q as me}from"./QTable.50d33692.js";import{Q as pe}from"./QPage.80b32476.js";import{f as _e,b as fe,a as k,A as T}from"./sessionFunctions.3c5066a4.js";import{B as ve}from"./BidStatus.bec4e2ae.js";import{n as J}from"./navigate.3bf18681.js";import{s as R}from"./dialogUtils.7f45a23c.js";import"./QList.72d1a296.js";import"./QSelect.3898a8f6.js";import"./QItem.35fdbb09.js";import"./format.4f6c3584.js";import"./selection.54367025.js";import"./rtl.276c3f1b.js";import"./formatTimeToLocal.04abce99.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./urls.d05eee06.js";const ge={class:"flexcolum-container q-gutter-md"},be={key:0,class:"q-mt-md q-gutter-xs row"},he={class:"q-mt-md"},we={class:"q-mb-md"},ye={class:"q-mb-md"},Se={class:"q-mb-md"},Ve={key:1,class:"q-mb-md"},Ce={key:2},q=5e5,Ae="N",je={__name:"UpdateSeatPrice",setup(ke){let i=0;const y=_e(["matchNumber","userContext"]);let P={};const Q=oe(),E=c({}),n=c([]),S=c([]),V=c(0),C=c(1),I=c(1),f=c(!1),N=c(!1),b=c(""),d=[],j=[{name:"seat_no",label:"\uC88C\uC11D",align:"left",field:"seat_no",sortable:!0},{name:"row_no",label:"\uC5F4",align:"left",field:"row_no",sortable:!0},{name:"col_no",label:"\uCEEC\uB7FC",align:"left",field:"col_no",sortable:!0},{name:"seat_price",label:"\uCD5C\uC18C \uC785\uCC30\uAC00",align:"right",field:"seat_price",sortable:!0},{name:"actions",label:"",align:"right"}],Y=async t=>{try{const e=await k.get(T.GET_BIDSTATUS,{params:{matchNumber:t}},{withCredentials:!0});E.value=e.data,N.value=E.value.bidStatusCode===Ae}catch(e){v(e)}},U=async t=>{try{const e=await k.get(T.GET_SEATPRICE,{params:{matchNumber:t}});n.value=e.data.map(l=>({...l,matchNumber:t})),S.value=JSON.parse(JSON.stringify(n.value))}catch(e){v(e)}},G=async()=>{const{isValid:t}=K(n.value);if(!t)return;const e=W(n.value,S.value);if(e.length===0&&d.value.length===0){alert("\uBCC0\uACBD\uB41C \uB0B4\uC6A9\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.");return}const l=X(e.length,d.value.length);if(!!confirm(l)&&d.value.length>0){await B(d.value,i),d.value=[],e.length>0&&await M(e),alert("\uC791\uC5C5\uC774 \uC131\uACF5\uC801\uC73C\uB85C \uC218\uD589\uB418\uC5C8\uC2B5\uB2C8\uB2E4.");try{await U(i)}catch(a){v(a)}}},B=async(t,e)=>{try{return(await k.post(T.DELETE_SEATPRICEARRAY,{seatPriceArray:t,matchNumber:e})).data.message}catch(l){return v(l),null}},M=async(t,e)=>{try{return(await k.post(T.UPDATE_SEATPRICEARRAY,{seatPriceArray:t,matchNumber:e})).data.message}catch(l){return v(l),null}},K=t=>{const e=t.filter(u=>!u.seat_no||u.seat_no.trim()===""||u.seat_price<=0||u.seat_price>q);if(e.length===0)return{isValid:!0,message:""};const l=e.filter(u=>!u.seat_no||u.seat_no.trim()===""),a=e.filter(u=>u.seat_price<=0||u.seat_price>q);let s="";return l.length>0&&(s+=`\uC88C\uC11D \uBC88\uD638\uAC00 \uC5C6\uB294 \uD56D\uBAA9: ${l.map(u=>`(\uAC00\uACA9: ${u.seat_price})`).join(", ")}
`),a.length>0&&(s+=`\uAC00\uACA9\uC774 0 \uC774\uD558\uC774\uAC70\uB098 ${q} \uC774\uC0C1\uC778 \uD56D\uBAA9\uC774 \uC788\uC2B5\uB2C8\uB2E4.
: ${a.map(u=>`\uC88C\uC11D\uBC88\uD638 ${u.seat_no} (\uAC00\uACA9: ${u.seat_price})
`).join(", ")}
`),alert(s),{isValid:!1}},W=(t,e)=>t.filter(l=>{const a=e.find(s=>s.seat_no===l.seat_no);return!a||a.seat_price!==l.seat_price||a.row_no!==l.row_no||a.col_no!==l.col_no}),X=(t,e)=>t>0&&e>0?`\uCD1D ${t}\uAC1C\uC758 \uC88C\uC11D\uC774 \uC5C5\uB370\uC774\uD2B8\uB418\uACE0 ${e}\uAC1C\uC758 \uC88C\uC11D\uC774 \uC0AD\uC81C\uB429\uB2C8\uB2E4. \uACC4\uC18D\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?`:t>0?`\uCD1D ${t}\uAC1C\uC758 \uC88C\uC11D\uC774 \uC5C5\uB370\uC774\uD2B8\uB429\uB2C8\uB2E4. \uACC4\uC18D\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?`:e>0?`\uCD1D ${e}\uAC1C\uC758 \uC88C\uC11D\uC774 \uC0AD\uC81C\uB429\uB2C8\uB2E4. \uACC4\uC18D\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?`:"\uBCC0\uACBD \uC0AC\uD56D\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.",A=(t,e,l)=>{t[e]=l},z=t=>{const e=t.seat_no;if(!e||e.trim()===""){n.value=n.value.filter(l=>l!==t);return}R({title:"\uC88C\uC11D \uC0AD\uC81C \uD655\uC778",message:"\uC815\uB9D0\uB85C \uC774 \uC88C\uC11D\uC744 \uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C? \uCD5C\uC885\uC0AD\uC81C\uB294 \uC791\uC5C5 \uC885\uB8CC \uD6C4 `\uC218\uC815 \uB0B4\uC5ED \uC81C\uCD9C\uBC84\uD2BC`\uC744 \uB204\uB974\uBA74 \uBC18\uC601\uB429\uB2C8\uB2E4.",okLabel:"\uC608",cancelLabel:"\uC544\uB2C8\uC624",onOk:()=>{d.value.push({seat_no:e}),n.value=n.value.filter(l=>l!==t)},onCancel:()=>{console.log("\uC88C\uC11D \uC0AD\uC81C\uAC00 \uCDE8\uC18C\uB418\uC5C8\uC2B5\uB2C8\uB2E4.")}})},F=()=>{const t=Math.max(0,...n.value.map(e=>Number(e.seat_no)||0));n.value.push({row_no:"",col_no:"",seat_no:String(t+1),seat_price:0,matchNumber:i})},H=async()=>{let t;n.value.length===0?f.value=!0:R({title:"\uC0C8\uB85C\uC6B4 \uC88C\uC11D \uC815\uBCF4 \uC0DD\uC131",message:"\uD604\uC7AC \uC88C\uC11D\uC774 \uBAA8\uB450 \uC0AD\uC81C\uB41C \uD6C4 \uC0C8 \uC88C\uC11D\uC774 \uC0DD\uC131\uB429\uB2C8\uB2E4. \uACC4\uC18D\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?",onOk:async()=>{d.value=n.value,d.value.length>0&&(t=await B(d.value,i)),S.value=[],d.value=[],n.value=[],f.value=!0,b.value=t},onCancel:()=>{alert("\uC791\uC5C5\uC774 \uCDE8\uC18C\uB418\uC5C8\uC2B5\uB2C8\uB2E4.")}})},Z=async()=>{if(V.value<=0||C.value<1){alert("\uC88C\uC11D \uAC1C\uC218\uC640 \uC2DC\uC791 \uBC88\uD638\uB294 1 \uC774\uC0C1\uC758 \uC22B\uC790\uC5EC\uC57C \uD569\uB2C8\uB2E4.");return}n.value=Array.from({length:V.value},(e,l)=>({row_no:"",col_no:"",seat_no:String(C.value+l),seat_price:I.value,matchNumber:i}));const t=n.value.map(e=>({...e}));if(t.length>0){b.value=await M(t),f.value=!1;try{await U(i)}catch(e){v(e)}}},ee=()=>{R({title:"\uC785\uB825 \uB0B4\uC6A9 \uCDE8\uC18C",message:"\uC815\uB9D0\uB85C \uBCC0\uACBD \uB0B4\uC6A9\uC744 \uCDE8\uC18C\uD558\uACE0 \uC6D0\uB798 \uC0C1\uD0DC\uB85C \uB418\uB3CC\uB9AC\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?",okLabel:"\uC608",cancelLabel:"\uC544\uB2C8\uC624",onOk:()=>{n.value=JSON.parse(JSON.stringify(S.value))},onCancel:()=>{}})},ae=()=>{f.value=!1},te=()=>{J(Q,y.userContext,"login")},le=()=>{emit("update-status",{isLoggedIn:!1,hasSelectedMatch:!1})},v=t=>{b.value=t.response?t.response.data:t.request?L.ERR_NETWORK:L.ERR_ETC};return se(async()=>{i=y.matchNumber,i?(P=await fe(y.userContext),P.success||(le(),te()),await Y(i),await U(i)):(alert("\uACBD\uAE30\uB97C \uBA3C\uC800 \uC120\uD0DD\uD574\uC8FC\uC138\uC694."),J(Q,y.userContext,"selectMatch"))}),(t,e)=>{const l=ne("q-title");return h(),$(pe,{class:"common-container q-pa-md"},{default:r(()=>[o(ve,{bidStatus:E.value},null,8,["bidStatus"]),m("div",ge,[N.value?(h(),x("div",be,[e[7]||(e[7]=m("br",null,null,-1)),m("div",null,[o(p,{push:"",color:"white","text-color":"blue-grey-14",label:"\uC88C\uC11D \uC77C\uAD04 \uC0DD\uC131",onClick:H}),e[4]||(e[4]=g("\xA0\xA0\xA0\xA0\xA0 ")),o(p,{push:"","text-color":"blue-grey-14",onClick:F,label:"\uC0C8\uB85C\uC6B4 \uD589 \uCD94\uAC00"}),e[5]||(e[5]=g("\xA0\xA0\xA0\xA0\xA0 ")),o(p,{push:"",color:"white","text-color":"deep-orange-14",onClick:ee,label:"\uC785\uB825\uB0B4\uC6A9 \uCDE8\uC18C"}),e[6]||(e[6]=g("\xA0\xA0\xA0\xA0\xA0 ")),o(p,{color:"primary",onClick:G,label:"\uC218\uC815 \uB0B4\uC6A9 \uC81C\uCD9C"})])])):D("",!0),m("div",he,[b.value?(h(),$(O,{key:0,class:"q-mt-md"},{default:r(()=>[g(re(b.value),1)]),_:1})):D("",!0),o(ce,{modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=a=>f.value=a)},{default:r(()=>[o(ue,null,{default:r(()=>[o(ie,null,{default:r(()=>[m("div",we,[o(_,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=a=>V.value=a),modelModifiers:{number:!0},label:"\uC0DD\uC131\uD560 \uC88C\uC11D\uC218",type:"number",outlined:""},null,8,["modelValue"])]),m("div",ye,[o(_,{modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=a=>C.value=a),modelModifiers:{number:!0},label:"\uC2DC\uC791 \uBC88\uD638",type:"number",outlined:""},null,8,["modelValue"])]),m("div",Se,[o(_,{modelValue:I.value,"onUpdate:modelValue":e[2]||(e[2]=a=>I.value=a),modelModifiers:{number:!0},label:"\uAE30\uBCF8 \uAC00\uACA9",type:"number",outlined:""},null,8,["modelValue"])])]),_:1}),o(de,{align:"right"},{default:r(()=>[o(p,{push:"",color:"white","text-color":"primary",onClick:Z,label:"\uC0DD\uC131"}),o(p,{push:"",color:"white","text-color":"deep-orange-14",onClick:ae,label:"\uCDE8\uC18C"})]),_:1})]),_:1})]),_:1},8,["modelValue"]),!n.value||n.value.length===0?(h(),x("div",Ve,[o(O,{type:"warning"},{default:r(()=>e[8]||(e[8]=[g(" \uC88C\uC11D \uC77C\uAD04 \uC0DD\uC131 \uBC84\uD2BC\uC744 \uB20C\uB7EC \uAC00\uACA9\uC744 \uC785\uB825\uD558\uC5EC \uC8FC\uC138\uC694. ")])),_:1})])):(h(),x("div",Ce,[e[10]||(e[10]=m("br",null,null,-1)),o(l,{level:"h6"},{default:r(()=>e[9]||(e[9]=[g("\uC88C\uC11D\uBCC4 \uCD5C\uC18C \uC785\uCC30 \uAC00\uACA9")])),_:1}),e[11]||(e[11]=m("br",null,null,-1)),o(me,{rows:n.value,columns:j,"row-key":"seat_no",class:"q-mt-none text-xs"},{"body-cell-seat_no":r(a=>[o(w,{props:a},{default:r(()=>[o(_,{modelValue:a.row.seat_no,"onUpdate:modelValue":s=>a.row.seat_no=s,dense:"",type:"text",onInput:s=>A(a.row,"seat_no",s),readonly:""},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1032,["props"])]),"body-cell-row_no":r(a=>[o(w,{props:a},{default:r(()=>[o(_,{modelValue:a.row.row_no,"onUpdate:modelValue":s=>a.row.row_no=s,dense:"",type:"text",onInput:s=>A(a.row,"row_no",s)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1032,["props"])]),"body-cell-col_no":r(a=>[o(w,{props:a},{default:r(()=>[o(_,{modelValue:a.row.col_no,"onUpdate:modelValue":s=>a.row.col_no=s,dense:"",type:"text",onInput:s=>A(a.row,"col_no",s)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1032,["props"])]),"body-cell-seat_price":r(a=>[o(w,{props:a},{default:r(()=>[o(_,{modelValue:a.row.seat_price,"onUpdate:modelValue":s=>a.row.seat_price=s,modelModifiers:{number:!0},dense:"",type:"number",onInput:s=>A(a.row,"seat_price",s)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1032,["props"])]),"body-cell-actions":r(a=>[o(w,{props:a,align:"right"},{default:r(()=>[o(p,{onClick:s=>z(a.row),push:"",color:"white","text-color":"deep-orange-14",label:"\uC0AD\uC81C",disable:!N.value},null,8,["onClick","disable"])]),_:2},1032,["props"])]),_:1},8,["rows"])]))])])]),_:1})}}};export{je as default};
